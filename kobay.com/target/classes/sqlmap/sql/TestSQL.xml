<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="searchSpace">
	<typeAlias alias="testVO" type="kobay.com.service.TestVO"/>
	<typeAlias alias="searchVO" type="kobay.com.search.SearchVO"/>
	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias alias="pageVO" type="kobay.com.cmmn.PageVO"/>
	
	<select id="test.getDept" resultClass="testVO">
		select deptno, dname, loc from dept where deptno=#deptno#
	</select>
	
	
	<!-- SearchList -->
	<select id="search.getList" parameterClass="pageVO" resultClass="egovMap">
		SELECT A.* FROM (
			SELECT ROWNUM RN, B.* FROM (
				<!-- SELECT 
					auctionUnq, 
					to_char(sdate, 'yyyy-mm-dd')sDate, 
					to_char(eDate, 'yyyy-mm-dd')eDate,
					aucTitle,
					aucImageMain, 
					aucImageSub1, 
					aucImageSub2, 
					aucImageSub3, 
					ePrice, 
					sellerName, 
					aucStatus 
				FROM 
					KOBAYAUCTION
				WHERE 1=1 -->
				SELECT  k.auctionUnq, 
	                to_char(k.sdate, 'yyyy-mm-dd')sDate, 
	                to_char(k.eDate, 'yyyy-mm-dd')eDate,
	                k.aucTitle,
	                k.aucImageMain, 
	                k.aucImageSub1, 
	                k.aucImageSub2, 
	                k.aucImageSub3, 
	                k.ePrice, 
	                k.sellerName, 
	                k.aucStatus,
	                (select max(bidprice) from AUCTIONBID where AUCTIONUNQ =  K.AUCTIONUNQ)price,
	                (select count(*) from AUCTIONBID where AUCTIONUNQ =  K.AUCTIONUNQ)bids
				FROM    KOBAYAUCTION K, (select distinct(auctionunq) from auctionbid) A
				WHERE  K.AUCTIONUNQ = a.auctionunq
				<isNotNull property="orderCondition">
					<isEqual property="orderCondition" compareValue="best">
						ORDER BY bids DESC ) B 
					</isEqual>
					<isEqual property="orderCondition" compareValue="close">
						ORDER BY abs( TO_DATE( edate,'YYYY-MM-DD') - TO_DATE( to_char(sysdate, 'YYYY-mm-dd'),'YYYY-MM-DD')) asc ) B 
					</isEqual>
					<isEqual property="orderCondition" compareValue="recent">
						ORDER BY abs( TO_DATE( sdate,'YYYY-MM-DD') - TO_DATE( to_char(sysdate, 'YYYY-mm-dd'),'YYYY-MM-DD')) asc ) B 
					</isEqual>
					<isEqual property="orderCondition" compareValue="lowprice">
						ORDER BY price asc ) B 
					</isEqual>
					<isEqual property="orderCondition" compareValue="highprice">
						ORDER BY price DESC ) B  
					</isEqual>
					<isEqual property="orderCondition" compareValue="">
						ORDER BY auctionUnq DESC ) B 
					</isEqual>
				</isNotNull>
				<isNull property="orderCondition">
					ORDER BY auctionUnq DESC ) B 
				</isNull>	
				) A
				WHERE RN >= 1 AND RN <![CDATA[<=]]> 100 
				AND TO_DATE( edate,'YYYY-MM-DD') - TO_DATE( to_char(sysdate, 'YYYY-mm-dd'),'YYYY-MM-DD') > 0
		 
		 <!--  WHERE RN >= #firstIndex# AND RN <![CDATA[<=]]> #lastIndex#  -->
	</select>

</sqlMap>